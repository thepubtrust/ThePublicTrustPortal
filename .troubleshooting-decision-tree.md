# Troubleshooting Decision Tree: Live Site Not Matching Repository

## Problem: Changes committed/pushed but not visible on live site

### Step 0 (check first): CSS layout hiding content
**Why:** The design CSS can clip or hide the fourth column (Featured Outdoor Writing) if the grid min-width exceeds the container.
- [ ] **Grid vs container:** `.news-grid` uses `grid-template-columns: repeat(4, minmax(320px, 1fr))` → 4×320 = 1280px minimum. `.container` is `max-width: 1200px`. On viewports ≤1200px the 4th column overflows and is clipped by `body { overflow-x: hidden }`, so Featured Outdoor Writing (and new items there) **does not show**.
- [ ] **Fix:** In `style.css`, ensure `.news-grid` columns fit inside the container, e.g. `minmax(260px, 1fr)` or `minmax(280px, 1fr)` so 4 columns + gaps fit in ~1200px. If you see “content in repo but not on the web” and it’s the 4th column, this is the usual cause.

**If CSS is the issue:** Adjust the grid `minmax()` so four columns fit within the container; commit and push.

---

### Step 0b: GitHub Pages publishing (if using GitHub Actions deploy)

**Why:** The live site is built by the "Deploy to GitHub Pages" workflow. If Pages isn’t using it or the run didn’t finish, the site won’t update.

1. **Pages source**  
   Repo → **Settings → Pages**. Under "Build and deployment", **Source** must be **"GitHub Actions"**.  
   If it’s "Deploy from a branch", the workflow’s deploy is ignored and the site comes from the branch you chose (e.g. main / root). Changing to "GitHub Actions" and saving fixes it.

2. **Workflow and environment**  
   - Repo → **Actions** → open the latest **"Deploy to GitHub Pages"** run for your push.  
   - It must finish with a green **Success**.  
   - If it’s **"Waiting for approval"**, go to **Settings → Environments → github-pages** and either approve the run or turn off "Required reviewers".

3. **Re-run deploy (optional)**  
   In **Actions**, open the latest "Deploy to GitHub Pages" run → **Re-run all jobs**.  
   After it succeeds, wait a minute and do a hard refresh (Cmd+Shift+R / Ctrl+Shift+R) or try in a private window.

4. **Live URL**  
   - With GitHub Actions: the URL is whatever is set in **Settings → Pages** (e.g. `https://thepubtrust.github.io/ThePublicTrustPortal/` or your custom domain).  
   - Use that exact URL when checking for updates.

---

### Step 1: Check Client-Side JavaScript (HIGHEST PRIORITY)
**Why:** JavaScript runs after page load and can modify/re-sort content
- [ ] Check `app.js` (or main JS file) for:
  - `sortArticlesByDate()` or similar sorting functions
  - `querySelectorAll()` + DOM manipulation
  - Functions that run on `DOMContentLoaded` or `load` events
  - Date parsing logic that might misinterpret dates
- [ ] Check browser console for JavaScript errors
- [ ] Verify JS date parsing matches server-side logic

**If JS is the issue:** Fix the JavaScript, commit, push, wait for deployment

---

### Step 2: Verify Repository Content
**Why:** Confirm what's actually in the repo
- [ ] `git log --oneline -3` - verify latest commits
- [ ] `git show HEAD:index.html | grep "specific-content"` - verify content exists
- [ ] Check file line counts match: `wc -l index.html` vs live site

**If repo is wrong:** Fix the repository content

---

### Step 3: Check Deployment Status
**Why:** Verify deployment actually completed
- [ ] Check GitHub Actions: `https://github.com/[org]/[repo]/actions`
- [ ] Verify latest workflow run shows "success"
- [ ] Check if deployment environment needs approval
- [ ] Verify deployment timestamp matches commit time

**If deployment failed:** Check logs, fix issues, re-deploy

---

### Step 4: Check CDN/Caching
**Why:** CDN might be serving stale content
- [ ] Check HTTP headers: `curl -I https://[site]`
- [ ] Look for `x-cache: HIT` or `cache-control` headers
- [ ] If custom domain, check CDN dashboard (Cloudflare, etc.)
- [ ] Purge CDN cache if needed

**If caching issue:** Purge cache or wait for TTL expiration

---

### Step 5: Browser-Specific Issues
**Why:** Browser cache or extensions might interfere
- [ ] Hard refresh: `Ctrl+Shift+R` (Windows) or `Cmd+Shift+R` (Mac)
- [ ] Try incognito/private window
- [ ] Check browser DevTools → Network tab (disable cache)
- [ ] Check for service workers: DevTools → Application → Service Workers

**If browser cache:** Clear cache or use different browser

---

## Quick Reference Checklist

When user reports "changes not on live site":

1. ✅ **FIRST:** Check `app.js` for client-side sorting/rendering
2. ✅ Verify content exists in repository
3. ✅ Check deployment completed successfully
4. ✅ Check CDN/caching headers
5. ✅ Try hard refresh/incognito

**Time estimate:** Steps 1-2 should take < 2 minutes. Only proceed to 3-5 if 1-2 don't reveal the issue.

---

## Common Patterns

### Pattern: "Articles sorted wrong on live site"
- **99% of the time:** JavaScript `sortArticlesByDate()` with incorrect date parsing
- **Check:** `app.js` → `parseArticleDate()` function
- **Fix:** Update date parsing logic to match server-side

### Pattern: "Content missing on live site"
- **Check:** JavaScript `removeExpiredItems()` or filtering functions
- **Check:** Deployment actually included the file
- **Check:** CDN cache serving old version

### Pattern: "Changes deployed but not visible"
- **Check:** JavaScript modifying DOM after load
- **Check:** Service workers caching old content
- **Check:** Browser cache (hard refresh)

---

## Efficiency Rules

1. **Always check JavaScript first** - it's the most common cause
2. **Verify repo before checking deployment** - don't debug deployment of wrong content
3. **Check deployment status before CDN** - deployment might not have completed
4. **Browser cache is last resort** - usually not the issue if repo and deployment are correct
